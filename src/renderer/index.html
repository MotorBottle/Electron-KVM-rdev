<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KVM Client</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="title-bar">
                <h1>KVM Remote Control</h1>
            </div>
            <div class="controls">
                <div class="device-controls">
                    <label data-i18n="deviceLabel">Device:</label>
                    <select id="videoDevices" class="device-select">
                        <option value="">Select Video Device</option>
                    </select>
                    <label data-i18n="resolutionLabel">Resolution:</label>
                    <select id="resolutionSelect" class="device-select">
                        <option value="">Select Resolution</option>
                    </select>
                    <label data-i18n="fpsLabel">FPS:</label>
                    <select id="fpsSelect" class="device-select">
                        <option value="">Select FPS</option>
                    </select>
                    <button id="refreshDevices" class="btn btn-secondary" title="Refresh both video and HID devices">Refresh</button>
                    <button id="startVideo" class="btn btn-primary">Start Video</button>
                    <button id="stopVideo" class="btn btn-secondary" disabled>Stop Video</button>
                </div>
                <div class="hid-controls">
                    <select id="hidDevices" class="device-select">
                        <option value="">Select HID Device</option>
                    </select>
                    <button id="connectHID" class="btn btn-primary">Connect HID</button>
                    <button id="disconnectHID" class="btn btn-secondary" disabled>Disconnect HID</button>
                </div>
                <div class="quick-controls">
                    <button id="sendCAD" class="btn btn-warning" disabled title="Send Ctrl+Alt+Delete">Ctrl+Alt+Del</button>
                    <button id="virtualKeyboard" class="btn btn-secondary" disabled title="Virtual Keyboard">‚å®Ô∏è</button>
                    <button id="toggleFullscreen" class="btn btn-secondary" title="Toggle Fullscreen">‚õ∂</button>
                </div>
                <button id="sidebarToggle" class="btn sidebar-toggle">Settings</button>
            </div>
        </header>

        <main class="main-content">
            <div class="video-container">
                <div id="videoPlaceholder" class="video-placeholder">
                    <p>Select video device and click Start Video</p>
                </div>
                <video id="videoElement" class="video-stream" autoplay playsinline muted style="display: none;"></video>
            </div>
            
            <div class="info-panel">
                <div class="sidebar-header">
                    <button id="closeSidebar" class="btn btn-fold">‚Ä∫</button>
                    <h2>Settings</h2>
                </div>
                <div class="status">
                    <div class="status-item">
                        <span class="status-label" data-i18n="labelVideo">Video:</span>
                        <span id="videoStatus" class="status-value">Disconnected</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label" data-i18n="labelHID">HID:</span>
                        <span id="hidStatus" class="status-value">Disconnected</span>
                    </div>
                </div>

                <div class="language-controls">
                    <h3 data-i18n="languageTitle">Language</h3>
                    <select id="languageSelect" class="device-select">
                        <option value="en">English</option>
                        <option value="zh">‰∏≠Êñá</option>
                    </select>
                    <p class="mode-description" data-i18n="languageHint">Auto-detected by system language; you can override here.</p>
                </div>
                
                <div class="mouse-mode-controls">
                    <h3 data-i18n="mouseModeTitle">Mouse Mode</h3>
                    <div class="mode-toggle">
                        <label class="toggle-switch">
                            <input type="checkbox" id="mouseModeToggle">
                            <span class="toggle-slider"></span>
                        </label>
                        <span id="mouseModeLabel" class="mode-label">Absolute</span>
                    </div>
                    <p class="mode-description" id="mouseModeDescription">Click to send absolute mouse positions</p>
                </div>
                
                <div class="scroll-controls">
                    <h3 data-i18n="scrollTitle">Scroll Direction</h3>
                    <div class="mode-toggle">
                        <label class="toggle-switch">
                            <input type="checkbox" id="scrollReverseToggle">
                            <span class="toggle-slider"></span>
                        </label>
                        <span id="scrollDirectionLabel" class="mode-label">Natural</span>
                    </div>
                    <p class="mode-description" id="scrollDirectionDescription">Natural scrolling (like macOS/mobile)</p>
                </div>
                
                <div class="quit-key-controls">
                    <h3 data-i18n="quitKeyTitle">Quit Key Combination</h3>
                    <div class="quit-key-setting">
                        <span class="quit-key-display" id="quitKeyDisplay">Ctrl + Alt</span>
                        <button id="changeQuitKey" class="btn btn-secondary" data-i18n="changeBtn">Change</button>
                    </div>
                    <p class="mode-description" data-i18n="quitKeyDesc">Key combination to exit control mode</p>
                </div>
                
                <div class="test-controls">
                    <h3 data-i18n="testTitle">Test Controls</h3>
                    <div class="test-buttons">
                        <button id="testMouse" class="btn btn-test" data-i18n="testMouse">Test Mouse Click</button>
                        <button id="testKeyboard" class="btn btn-test" data-i18n="testKeyboard">Test Keyboard (A)</button>
                    </div>
                </div>

                <div class="custom-resolution-controls">
                    <h3 data-i18n="customResTitle">Custom Resolutions</h3>
                    <div class="custom-res-input">
                        <input id="customResInput" type="text" placeholder="1920x1200,2560x1440" />
                        <button id="addCustomRes" class="btn btn-secondary" data-i18n="addBtn">Add</button>
                    </div>
                    <p class="mode-description" data-i18n="customResDesc">Append to the resolution menu (no guarantee device supports them).</p>
                </div>
            </div>
        </main>

        <div class="mouse-capture-overlay" id="mouseCaptureOverlay" style="display: none;">
            <div class="mouse-capture-info">
                <div style="font-weight: 600; margin-bottom: 6px;" data-i18n="controlModeTitle">üéÆ Control Mode Active</div>
                <div style="margin-bottom: 4px;" data-i18n="controlModeHint">Press <kbd>Ctrl</kbd> + <kbd>Alt</kbd> to exit</div>
            </div>
        </div>

        <!-- Quit Key Change Modal -->
        <div class="quit-key-modal" id="quitKeyModal" style="display: none;">
            <div class="quit-key-content">
                <h3>Change Quit Key Combination</h3>
                <p>Press the key combination you want to use to exit control mode:</p>
                
                <div class="key-capture-area" id="keyCaptureArea">
                    <div class="captured-keys" id="capturedKeys">Press keys...</div>
                </div>
                
                <div class="modal-buttons">
                    <button id="confirmQuitKey" class="btn btn-primary" disabled>Confirm</button>
                    <button id="cancelQuitKey" class="btn btn-secondary">Cancel</button>
                    <button id="resetQuitKey" class="btn btn-warning">Reset to Default</button>
                </div>
                
                <div class="quit-key-help">
                    <p><strong>Tips:</strong></p>
                    <ul>
                        <li>Use modifier keys (Ctrl, Alt, Shift, Meta) for reliability</li>
                        <li>Avoid single keys that might be used normally</li>
                        <li>Common combinations: Ctrl+Alt, Ctrl+Shift, Alt+Shift</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Virtual Keyboard Modal -->
        <div class="virtual-keyboard-modal" id="virtualKeyboardModal" style="display: none;">
            <div class="virtual-keyboard-content" id="virtualKeyboardContent">
                <div class="virtual-keyboard-header" id="virtualKeyboardHeader">
                    <div class="header-left">
                        <h3>Virtual Keyboard</h3>
                    </div>
                    <div class="header-right">
                        <div class="combination-info">
                            <span class="combination-label">Combination:</span>
                            <span class="combination-keys" id="combinationKeys">None</span>
                        </div>
                        <button class="btn btn-primary" id="sendCombination" disabled>Send</button>
                        <button class="btn btn-secondary" id="clearCombination">Clear</button>
                        <button id="closeVirtualKeyboard" class="btn btn-secondary">√ó</button>
                    </div>
                </div>
                
                <div class="virtual-keyboard">
                    <!-- Column 1: Main Keyboard Area -->
                    <div class="keyboard-column main-keyboard">
                        <!-- Function Keys Row -->
                        <div class="keyboard-row function-row">
                            <button class="key-btn function-key" data-key="Escape" data-code="Escape">Esc</button>
                            <div class="key-spacer"></div>
                            <button class="key-btn function-key" data-key="F1" data-code="F1">F1</button>
                            <button class="key-btn function-key" data-key="F2" data-code="F2">F2</button>
                            <button class="key-btn function-key" data-key="F3" data-code="F3">F3</button>
                            <button class="key-btn function-key" data-key="F4" data-code="F4">F4</button>
                            <div class="key-spacer"></div>
                            <button class="key-btn function-key" data-key="F5" data-code="F5">F5</button>
                            <button class="key-btn function-key" data-key="F6" data-code="F6">F6</button>
                            <button class="key-btn function-key" data-key="F7" data-code="F7">F7</button>
                            <button class="key-btn function-key" data-key="F8" data-code="F8">F8</button>
                            <div class="key-spacer"></div>
                            <button class="key-btn function-key" data-key="F9" data-code="F9">F9</button>
                            <button class="key-btn function-key" data-key="F10" data-code="F10">F10</button>
                            <button class="key-btn function-key" data-key="F11" data-code="F11">F11</button>
                            <button class="key-btn function-key" data-key="F12" data-code="F12">F12</button>
                        </div>
                        
                        <!-- Number Row -->
                        <div class="keyboard-row number-row">
                            <button class="key-btn" data-key="`" data-code="Backquote">`</button>
                            <button class="key-btn" data-key="1" data-code="Digit1">1</button>
                            <button class="key-btn" data-key="2" data-code="Digit2">2</button>
                            <button class="key-btn" data-key="3" data-code="Digit3">3</button>
                            <button class="key-btn" data-key="4" data-code="Digit4">4</button>
                            <button class="key-btn" data-key="5" data-code="Digit5">5</button>
                            <button class="key-btn" data-key="6" data-code="Digit6">6</button>
                            <button class="key-btn" data-key="7" data-code="Digit7">7</button>
                            <button class="key-btn" data-key="8" data-code="Digit8">8</button>
                            <button class="key-btn" data-key="9" data-code="Digit9">9</button>
                            <button class="key-btn" data-key="0" data-code="Digit0">0</button>
                            <button class="key-btn" data-key="-" data-code="Minus">-</button>
                            <button class="key-btn" data-key="=" data-code="Equal">=</button>
                            <button class="key-btn backspace-key" data-key="Backspace" data-code="Backspace">Backspace</button>
                        </div>
                        
                        <!-- Top Letter Row -->
                        <div class="keyboard-row top-letter-row">
                            <button class="key-btn tab-key" data-key="Tab" data-code="Tab">Tab</button>
                            <button class="key-btn" data-key="q" data-code="KeyQ">Q</button>
                            <button class="key-btn" data-key="w" data-code="KeyW">W</button>
                            <button class="key-btn" data-key="e" data-code="KeyE">E</button>
                            <button class="key-btn" data-key="r" data-code="KeyR">R</button>
                            <button class="key-btn" data-key="t" data-code="KeyT">T</button>
                            <button class="key-btn" data-key="y" data-code="KeyY">Y</button>
                            <button class="key-btn" data-key="u" data-code="KeyU">U</button>
                            <button class="key-btn" data-key="i" data-code="KeyI">I</button>
                            <button class="key-btn" data-key="o" data-code="KeyO">O</button>
                            <button class="key-btn" data-key="p" data-code="KeyP">P</button>
                            <button class="key-btn" data-key="[" data-code="BracketLeft">[</button>
                            <button class="key-btn" data-key="]" data-code="BracketRight">]</button>
                            <button class="key-btn backslash-key" data-key="\\" data-code="Backslash">\\</button>
                        </div>
                        
                        <!-- Middle Letter Row -->
                        <div class="keyboard-row middle-letter-row">
                            <button class="key-btn caps-key modifier-key" data-key="CapsLock" data-code="CapsLock">Caps</button>
                            <button class="key-btn" data-key="a" data-code="KeyA">A</button>
                            <button class="key-btn" data-key="s" data-code="KeyS">S</button>
                            <button class="key-btn" data-key="d" data-code="KeyD">D</button>
                            <button class="key-btn" data-key="f" data-code="KeyF">F</button>
                            <button class="key-btn" data-key="g" data-code="KeyG">G</button>
                            <button class="key-btn" data-key="h" data-code="KeyH">H</button>
                            <button class="key-btn" data-key="j" data-code="KeyJ">J</button>
                            <button class="key-btn" data-key="k" data-code="KeyK">K</button>
                            <button class="key-btn" data-key="l" data-code="KeyL">L</button>
                            <button class="key-btn" data-key=";" data-code="Semicolon">;</button>
                            <button class="key-btn" data-key="'" data-code="Quote">'</button>
                            <button class="key-btn enter-key" data-key="Enter" data-code="Enter">Enter</button>
                        </div>
                        
                        <!-- Bottom Letter Row -->
                        <div class="keyboard-row bottom-letter-row">
                            <button class="key-btn shift-key modifier-key" data-key="ShiftLeft" data-code="ShiftLeft">Shift</button>
                            <button class="key-btn" data-key="z" data-code="KeyZ">Z</button>
                            <button class="key-btn" data-key="x" data-code="KeyX">X</button>
                            <button class="key-btn" data-key="c" data-code="KeyC">C</button>
                            <button class="key-btn" data-key="v" data-code="KeyV">V</button>
                            <button class="key-btn" data-key="b" data-code="KeyB">B</button>
                            <button class="key-btn" data-key="n" data-code="KeyN">N</button>
                            <button class="key-btn" data-key="m" data-code="KeyM">M</button>
                            <button class="key-btn" data-key="," data-code="Comma">,</button>
                            <button class="key-btn" data-key="." data-code="Period">.</button>
                            <button class="key-btn" data-key="/" data-code="Slash">/</button>
                            <button class="key-btn shift-key modifier-key" data-key="ShiftRight" data-code="ShiftRight">Shift</button>
                        </div>
                        
                        <!-- Bottom Row -->
                        <div class="keyboard-row bottom-row">
                            <button class="key-btn ctrl-key modifier-key" data-key="ControlLeft" data-code="ControlLeft">Ctrl</button>
                            <button class="key-btn win-key modifier-key" data-key="MetaLeft" data-code="MetaLeft">‚åò</button>
                            <button class="key-btn alt-key modifier-key" data-key="AltLeft" data-code="AltLeft">Alt</button>
                            <button class="key-btn space-key" data-key=" " data-code="Space">Space</button>
                            <button class="key-btn alt-key modifier-key" data-key="AltRight" data-code="AltRight">Alt</button>
                            <button class="key-btn win-key modifier-key" data-key="MetaRight" data-code="MetaRight">‚åò</button>
                            <button class="key-btn menu-key modifier-key" data-key="ContextMenu" data-code="ContextMenu">Menu</button>
                            <button class="key-btn ctrl-key modifier-key" data-key="ControlRight" data-code="ControlRight">Ctrl</button>
                        </div>
                    </div>
                    
                    <!-- Column 2: Navigation and System Keys -->
                    <div class="keyboard-column nav-keyboard">
                        <!-- System Keys Row -->
                        <div class="keyboard-row system-row">
                            <button class="key-btn function-key" data-key="PrintScreen" data-code="PrintScreen">PrtSc</button>
                            <button class="key-btn function-key" data-key="ScrollLock" data-code="ScrollLock">ScrLk</button>
                            <button class="key-btn function-key" data-key="Pause" data-code="Pause">Pause</button>
                        </div>
                        
                        <!-- Navigation Keys Row 1 -->
                        <div class="keyboard-row nav-row-1">
                            <button class="key-btn nav-key" data-key="Insert" data-code="Insert">Insert</button>
                            <button class="key-btn nav-key" data-key="Home" data-code="Home">Home</button>
                            <button class="key-btn nav-key" data-key="PageUp" data-code="PageUp">PgUp</button>
                        </div>
                        
                        <!-- Navigation Keys Row 2 -->
                        <div class="keyboard-row nav-row-2">
                            <button class="key-btn nav-key" data-key="Delete" data-code="Delete">Delete</button>
                            <button class="key-btn nav-key" data-key="End" data-code="End">End</button>
                            <button class="key-btn nav-key" data-key="PageDown" data-code="PageDown">PgDn</button>
                        </div>
                        
                        <!-- Arrow Keys Section -->
                        <div class="arrow-keys-spacer"></div>
                        <div class="arrow-keys-cluster">
                            <div class="arrow-row-1">
                                <button class="key-btn arrow-key" data-key="ArrowUp" data-code="ArrowUp">‚Üë</button>
                            </div>
                            <div class="arrow-row-2">
                                <button class="key-btn arrow-key" data-key="ArrowLeft" data-code="ArrowLeft">‚Üê</button>
                                <button class="key-btn arrow-key" data-key="ArrowDown" data-code="ArrowDown">‚Üì</button>
                                <button class="key-btn arrow-key" data-key="ArrowRight" data-code="ArrowRight">‚Üí</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Column 3: Numeric Keypad -->
                    <div class="keyboard-column numpad-keyboard">
                        <!-- Numeric Keypad Section -->
                        <div class="numpad-section">
                            <div class="numpad-row numpad-row-1">
                                <button class="key-btn numpad-key" data-key="NumLock" data-code="NumLock">Num</button>
                                <button class="key-btn numpad-key" data-key="/" data-code="NumpadDivide">/</button>
                                <button class="key-btn numpad-key" data-key="*" data-code="NumpadMultiply">*</button>
                                <button class="key-btn numpad-key" data-key="-" data-code="NumpadSubtract">-</button>
                            </div>
                            <div class="numpad-row numpad-row-2">
                                <button class="key-btn numpad-key" data-key="7" data-code="Numpad7">7</button>
                                <button class="key-btn numpad-key" data-key="8" data-code="Numpad8">8</button>
                                <button class="key-btn numpad-key" data-key="9" data-code="Numpad9">9</button>
                                <button class="key-btn numpad-key numpad-tall" data-key="+" data-code="NumpadAdd">+</button>
                            </div>
                            <div class="numpad-row numpad-row-3">
                                <button class="key-btn numpad-key" data-key="4" data-code="Numpad4">4</button>
                                <button class="key-btn numpad-key" data-key="5" data-code="Numpad5">5</button>
                                <button class="key-btn numpad-key" data-key="6" data-code="Numpad6">6</button>
                            </div>
                            <div class="numpad-row numpad-row-4">
                                <button class="key-btn numpad-key" data-key="1" data-code="Numpad1">1</button>
                                <button class="key-btn numpad-key" data-key="2" data-code="Numpad2">2</button>
                                <button class="key-btn numpad-key" data-key="3" data-code="Numpad3">3</button>
                                <button class="key-btn numpad-key numpad-tall numpad-enter" data-key="Enter" data-code="NumpadEnter">Enter</button>
                            </div>
                            <div class="numpad-row numpad-row-5">
                                <button class="key-btn numpad-key numpad-zero" data-key="0" data-code="Numpad0">0</button>
                                <button class="key-btn numpad-key" data-key="." data-code="NumpadDecimal">.</button>
                            </div>
                        </div>
                    </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
